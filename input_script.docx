#!/bin/bash

# Define variables
NODE_NAME="node001"
IP_ADDRESS="192.168.1.101"
MAC_ADDRESS="00:11:22:33:44:55"
NETBOOT_IMAGE="centos7-netboot"
PROFILE="compute"

# Step 1: Define the node in xCAT
mkdef -t node -o $NODE_NAME groups=all mac=$MAC_ADDRESS ip=$IP_ADDRESS

# Step 2: Define the profile
mkdef -t profile -o $PROFILE
chdef -t profile -o $PROFILE kernel=$NETBOOT_IMAGE kcmdline="initrd=initrd.img ip=dhcp"

# Step 3: Assign the profile to the node
chdef -t node -o $NODE_NAME pprof=$PROFILE

# Step 4: Set the stateless flag for the node
chdef -t node -o $NODE_NAME provmethod=statelite

# Step 5: Start provisioning the node
nodeset $NODE_NAME osimage=$NETBOOT_IMAGE

echo "Node provisioning started for $NODE_NAME in stateless mode."
